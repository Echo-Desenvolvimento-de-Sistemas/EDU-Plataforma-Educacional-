import{r,a as c,j as e,H as P,b as d}from"./app-BlZNpJaz.js";import{A as Q,L as F,b as O}from"./app-layout-vfDevXcM.js";import{T as H,a as z,b as m,c as p}from"./tabs-3iks6wee.js";import{C as N,a as v,b as C,d as b,c as y}from"./card-DE5xUgg4.js";import{B as t}from"./button-BFaAQ1F0.js";import{GroupManager as B}from"./GroupManager-HJZTZyaA.js";import{I as M}from"./input-ClKI_C3W.js";import{L as q}from"./label-D4nWcODD.js";import{f as $,a as V,e as J,b as K,c as U,d as X,D as Y}from"./dialog-CCWmf-Wy.js";import{t as o}from"./index-Dzrob8QY.js";import{c as Z}from"./createLucideIcon-G_Aima0p.js";import{L as _}from"./loader-circle-DIuL06p2.js";import{R as ee}from"./refresh-cw-hJheOro6.js";import{P as se}from"./plus-CcX2yXqX.js";import{S as ae}from"./school-DbaGeIye.js";import{R as w}from"./radio-DX7XePgN.js";/* empty css            */import"./index-BSNktiLJ.js";import"./utils-CTsRgsKi.js";import"./index-DWBLVih3.js";import"./index-II6TlMg7.js";import"./Combination-CQbiwxas.js";import"./index-ePvy9ijt.js";import"./index-CClcdcON.js";import"./index-DSX7JKB1.js";import"./index-20W_Bwtk.js";import"./index-kh-3lYpY.js";import"./index-jOkOEACf.js";import"./settings-DDioBNBR.js";import"./users-CYmdu12r.js";import"./file-text-BPl73Zr-.js";import"./chevron-right-BaSAJNUd.js";import"./badge-hQq2_SSh.js";import"./popover-BAsQVsaB.js";import"./search-BKAEKSF4.js";import"./user-plus-BjTB18ph.js";import"./trash-2-C65_v2RJ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],A=Z("Smartphone",te);function Be({groups:S,classes:k,staff:D}){const[W,x]=r.useState(!1),[h,u]=r.useState(""),[L,n]=r.useState("unknown"),[g,i]=r.useState(null),[j,f]=r.useState(!1);r.useEffect(()=>{T()},[]);const T=()=>{c.get("/admin/settings/whatsapp/status").then(s=>{const a=s.data?.instance?.state||s.data?.state||"close";n(a)}).catch(()=>n("unknown"))},G=()=>{f(!0),c.post("/admin/settings/whatsapp/connect").then(s=>{if(s.data?.base64){i(s.data.base64);const a=setInterval(()=>{c.get("/admin/settings/whatsapp/status").then(l=>{(l.data?.instance?.state||l.data?.state)==="open"&&(n("open"),i(null),clearInterval(a),o.success("WhatsApp Conectado!"))})},2e3)}else if(s.data?.instance?.state==="open")n("open"),o.success("WhatsApp já está conectado!");else{const a=s.data?.error||"Erro desconhecido na API.";o.error(`Não foi possível gerar o QR Code: ${a}`),console.error("Falha na conexão:",s.data)}}).catch(s=>{console.error(s),s.response?.data?.message?o.error(`Erro: ${s.response.data.message}`):o.error("Erro ao conectar com a API.")}).finally(()=>f(!1))},E=()=>{confirm("Tem certeza que deseja desconectar?")&&d.post("/admin/settings/whatsapp/disconnect",{},{onSuccess:()=>{n("close"),i(null)}})},R=s=>{s.preventDefault(),d.post("/admin/agenda",{name:h,type:"BROADCAST"},{onSuccess:()=>{x(!1),u("")}})},I=s=>{const a=[s.series,s.letter].filter(Boolean).join(" "),l=a?`${a}`:s.name;d.post("/admin/agenda",{name:l,type:"CLASS",related_type:"App\\Models\\ClassRoom",related_id:s.id},{preserveScroll:!0})};return e.jsxs(Q,{breadcrumbs:[{title:"Agenda",href:"/admin/agenda"},{title:"Configurações",href:"/admin/agenda/settings"}],children:[e.jsx(P,{title:"Configurações Agenda"}),e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Configurações da Agenda"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie grupos de envio e permissões."})]}),e.jsxs(H,{defaultValue:"connection",className:"w-full",children:[e.jsxs(z,{children:[e.jsx(m,{value:"connection",children:"Conexão"}),e.jsx(m,{value:"groups",children:"Grupos de Envio"}),e.jsx(m,{value:"classes",children:"Turmas"})]}),e.jsx(p,{value:"connection",className:"space-y-4",children:e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Conexão WhatsApp"]}),e.jsx(b,{children:"Conecte o sistema ao WhatsApp para envio de mensagens automáticas via Evolution API."})]}),e.jsx(y,{className:"space-y-6",children:e.jsx("div",{className:"flex flex-col items-center justify-center p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border dark:border-gray-700",children:L==="open"?e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"h-20 w-20 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(F,{className:"h-10 w-10 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-green-600",children:"WhatsApp Conectado!"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"O sistema está pronto para enviar mensagens."})]}),e.jsxs(t,{variant:"destructive",onClick:E,children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Desconectar"]})]}):e.jsx("div",{className:"text-center space-y-4 w-full",children:g?e.jsxs("div",{className:"space-y-4 animate-in fade-in zoom-in duration-300",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Escaneie o QR Code"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Abra o WhatsApp > Aparelhos Conectados > Conectar Aparelho"}),e.jsx("div",{className:"bg-white p-4 rounded-lg inline-block border shadow-sm",children:e.jsx("img",{src:g,alt:"QR Code WhatsApp",className:"h-64 w-64 object-contain"})}),e.jsx("div",{children:e.jsx(t,{variant:"ghost",onClick:()=>i(null),children:"Cancelar"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-16 w-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto",children:e.jsx(A,{className:"h-8 w-8 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Não Conectado"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Clique abaixo para gerar o QR Code e conectar."})]}),e.jsx(t,{onClick:G,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Gerando QR Code..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Conectar WhatsApp"]})})]})})})})]})}),e.jsxs(p,{value:"groups",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs($,{open:W,onOpenChange:x,children:[e.jsx(V,{asChild:!0,children:e.jsxs(t,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Novo Grupo"]})}),e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(U,{children:"Criar Novo Grupo"}),e.jsx(X,{children:"Crie um grupo para disparos em massa (ex: Avisos Gerais)."})]}),e.jsxs("form",{onSubmit:R,children:[e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"name",children:"Nome do Grupo"}),e.jsx(M,{id:"name",value:h,onChange:s=>u(s.target.value),placeholder:"Ex: Avisos Importantes",required:!0})]})}),e.jsx(Y,{children:e.jsx(t,{type:"submit",children:"Criar Grupo"})})]})]})]})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:S.map(s=>e.jsx(B,{group:s,staff:D},s.id))})]}),e.jsx(p,{value:"classes",children:e.jsxs(N,{children:[e.jsxs(v,{children:[e.jsx(C,{children:"Turmas e Professores"}),e.jsx(b,{children:"Associação automática baseada nas alocações de aula."})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-8",children:k.map(s=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),s.name," ",e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",s.series," ",s.letter,")"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Professores habilitados:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.professors.length>0?s.professors.map(a=>e.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10",children:a.name},a.id)):e.jsx("span",{className:"text-sm text-yellow-600 italic",children:"Nenhum professor alocado."})})]}),e.jsx("div",{children:s.channel?e.jsxs(t,{variant:"outline",size:"sm",className:"text-green-600 border-green-200 bg-green-50 hover:bg-green-100 hover:text-green-700 cursor-default",children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Canal Ativo"]}):e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>I(s),children:[e.jsx(w,{className:"mr-2 h-4 w-4 text-muted-foreground"}),"Habilitar Canal"]})})]},s.id))})})]})})]})]})]})}export{Be as default};
