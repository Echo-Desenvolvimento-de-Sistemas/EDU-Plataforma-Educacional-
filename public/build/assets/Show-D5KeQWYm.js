import{r as f,j as e,H as we,L as le,b as ce,a as de,c as ye,u as Se}from"./app-BlZNpJaz.js";import{B as ne}from"./badge-hQq2_SSh.js";import{B as g}from"./button-BFaAQ1F0.js";import{C as H,c as M,a as se,b as ae,d as te}from"./card-DE5xUgg4.js";import{a as _e,b as Ce,c as De,d as Te,D as $e,e as Ae,f as Le}from"./dialog-CCWmf-Wy.js";import{I as W}from"./input-ClKI_C3W.js";import{L as T}from"./label-D4nWcODD.js";import{S as oe,a as me,b as xe,c as he,d as pe}from"./select-wa9XAM0x.js";import{T as ue,a as je,b as U,c as O,d as fe,e as D}from"./table-DRoYhqJ6.js";import{T as ke,a as Pe,b as re,c as ie}from"./tabs-3iks6wee.js";import{T as Fe}from"./textarea-BfFOsk1d.js";import{A as Ie}from"./app-layout-vfDevXcM.js";import{t as X}from"./index-Dzrob8QY.js";import{C as qe}from"./check-C5YBzlMP.js";import{T as Ge}from"./triangle-alert-SVse4Ker.js";import{L as ge}from"./loader-circle-DIuL06p2.js";import{S as ze}from"./save-zMiZTWPN.js";import{S as be}from"./square-pen-DkkVFjNN.js";import{T as Ee}from"./trash-2-C65_v2RJ.js";import{P as ve}from"./plus-CcX2yXqX.js";/* empty css            */import"./index-BSNktiLJ.js";import"./utils-CTsRgsKi.js";import"./index-DWBLVih3.js";import"./createLucideIcon-G_Aima0p.js";import"./index-II6TlMg7.js";import"./Combination-CQbiwxas.js";import"./index-ePvy9ijt.js";import"./index-20W_Bwtk.js";import"./index-CClcdcON.js";import"./index-DSX7JKB1.js";import"./index-DPYlP-Xg.js";import"./chevron-down-BzXkxksi.js";import"./index-kh-3lYpY.js";import"./index-jOkOEACf.js";import"./settings-DDioBNBR.js";import"./users-CYmdu12r.js";import"./file-text-BPl73Zr-.js";import"./chevron-right-BaSAJNUd.js";function Cs({classRoom:l,subjects:s,selectedSubjectId:J,periods:b,students:x,attendanceHistory:$}){const K=[{title:"Painel",href:"/professor/dashboard"},{title:l.name,href:`/professor/classes/${l.id}`}],[Y,A]=f.useState("grades"),[t,r]=f.useState(b.length>0?String(b[0].id):""),[n,L]=f.useState(String(J)),[h,Q]=f.useState([]),[w,k]=f.useState({}),[y,S]=f.useState(!1),[_,p]=f.useState(!1),o=b.find(a=>String(a.id)===t)?.status==="closed",u=async()=>{if(!(!t||!n)){S(!0);try{const a=await de.get(`/professor/classes/${l.id}/grades`,{params:{grading_period_id:t,subject_id:n}});Q(a.data.assessments),k(a.data.grades)}catch(a){console.error(a),X.error("Erro ao carregar notas.")}finally{S(!1)}}};f.useEffect(()=>{u()},[t,n]);const v=(a,i,c)=>{if(o)return;const d=c===""?null:parseFloat(c);k(j=>({...j,[a]:{...j[a]||{},[i]:d}}))},P=async()=>{if(o){X.error("Este período está fechado.");return}p(!0);const a=[];for(const i of x.map(c=>c.id)){const c=w[i]||{};for(const d of h)c[d.id]!==void 0&&a.push({student_id:i,assessment_id:d.id,score:c[d.id]})}try{await de.post(`/professor/classes/${l.id}/grades/batch`,{grading_period_id:t,subject_id:n,grades:a}),X.success("Notas salvas com sucesso!")}catch(i){console.error(i),X.error("Erro ao salvar notas.")}finally{p(!1)}},N=a=>{L(a),ce.visit(`/professor/classes/${l.id}?subject_id=${a}`,{preserveState:!0,preserveScroll:!0,onSuccess:()=>L(a)})};return e.jsxs(Ie,{breadcrumbs:K,children:[e.jsx(we,{title:`Turma ${l.name}`}),e.jsxs("div",{className:"flex h-full flex-col gap-4 p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end md:items-center justify-between bg-card p-4 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[l.name," ",e.jsxs("span",{className:"text-muted-foreground text-lg font-normal",children:["(",l.grade.name,")"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{children:"Disciplina:"}),e.jsxs(oe,{value:n,onValueChange:N,children:[e.jsx(me,{className:"w-[200px] h-8",children:e.jsx(xe,{})}),e.jsx(he,{children:s.map(a=>e.jsx(pe,{value:String(a.id),children:a.name},a.id))})]})]}),e.jsx(g,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",asChild:!0,children:e.jsxs(le,{href:`/professor/classes/${l.id}/attendance/create?subject_id=${n}`,children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Lançar Frequência"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[o&&e.jsxs(ne,{variant:"destructive",className:"items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Fechado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{children:"Bimestre:"}),e.jsxs(oe,{value:t,onValueChange:r,children:[e.jsx(me,{className:"w-[180px]",children:e.jsx(xe,{})}),e.jsx(he,{children:b.map(a=>e.jsx(pe,{value:String(a.id),children:a.name},a.id))})]})]})]})]}),e.jsxs(ke,{value:Y,onValueChange:A,className:"flex-1 flex flex-col",children:[e.jsxs(Pe,{className:"w-full justify-start border-b rounded-none p-0 h-auto bg-transparent gap-6",children:[e.jsx(re,{value:"overview",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none py-3",children:"Visão Geral"}),e.jsx(re,{value:"grades",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none py-3",children:"Lançamento de Notas (Grid)"}),e.jsx(re,{value:"assessments",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none py-3",children:"Gerenciar Avaliações"}),e.jsx(re,{value:"attendance",className:"rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:shadow-none py-3",children:"Frequência"})]}),e.jsxs(ie,{value:"overview",className:"flex-1 mt-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(H,{className:"bg-slate-50 border-slate-200",children:e.jsxs(M,{className:"p-6 flex flex-col items-center justify-center text-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 uppercase tracking-wider mb-1",children:"Total Alunos"}),e.jsx("span",{className:"text-3xl font-bold text-slate-900",children:x.length})]})}),e.jsx(H,{className:"bg-slate-50 border-slate-200",children:e.jsxs(M,{className:"p-6 flex flex-col items-center justify-center text-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 uppercase tracking-wider mb-1",children:"Frequência Média"}),e.jsxs("span",{className:"text-3xl font-bold text-slate-900",children:[Math.round(x.reduce((a,i)=>a+(i.attendance_rate||0),0)/(x.length||1)),"%"]})]})})]}),e.jsxs(H,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Lista de Alunos"}),e.jsx(te,{children:"Clique no aluno para ver detalhes individuais de notas e presença."})]}),e.jsx(M,{children:e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(U,{children:[e.jsx(O,{children:"Nome"}),e.jsx(O,{children:"Frequência (Disciplina)"}),e.jsx(O,{className:"text-right",children:"Ação"})]})}),e.jsx(fe,{children:x.map(a=>e.jsxs(U,{className:"group cursor-pointer hover:bg-slate-50",onClick:()=>ce.visit(`/professor/classes/${l.id}/students/${a.id}?subject_id=${n}`),children:[e.jsx(D,{className:"font-medium",children:a.name}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-24 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${(a.attendance_rate||100)>=75?"bg-green-500":(a.attendance_rate||100)>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${a.attendance_rate||100}%`}})}),e.jsxs("span",{className:"text-xs font-bold text-slate-600",children:[a.attendance_rate||100,"%"]})]})}),e.jsx(D,{className:"text-right",children:e.jsx(g,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 text-blue-600",children:"Ver Detalhes →"})})]},a.id))})]})})]})]}),e.jsx(ie,{value:"grades",className:"flex-1 mt-4 space-y-4",children:e.jsxs(H,{children:[e.jsxs(se,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ae,{children:"Diário de Classe"}),e.jsx(te,{children:"Lance as notas para as avaliações deste bimestre."})]}),e.jsxs(g,{onClick:P,disabled:_||y||o,className:"gap-2 bg-blue-600 hover:bg-blue-700 text-white",children:[_&&e.jsx(ge,{className:"h-4 w-4 animate-spin"}),e.jsx(ze,{className:"h-4 w-4"}),"Salvar Alterações"]})]}),e.jsx(M,{className:"overflow-auto",children:y?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(ge,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(U,{className:"hover:bg-transparent",children:[e.jsx(O,{className:"w-[300px] min-w-[200px] sticky left-0 bg-background z-20 font-bold text-primary",children:"Aluno"}),h.map(a=>e.jsx(O,{className:"text-center min-w-[100px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 py-2",children:[e.jsx("span",{className:"font-semibold text-foreground whitespace-nowrap",children:a.title}),e.jsx(ne,{variant:a.is_recovery?"destructive":"secondary",className:"text-[10px] h-5",children:a.is_recovery?"Recuperação":`Peso ${a.weight}`}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(a.date).toLocaleDateString("pt-BR")})]})},a.id)),e.jsx(O,{className:"text-center w-[100px] font-bold",children:"Média Atual"})]})}),e.jsxs(fe,{children:[x.map(a=>e.jsxs(U,{children:[e.jsx(D,{className:"sticky left-0 bg-background z-10 font-medium",children:a.name}),h.map(i=>{const c=w[a.id]?.[i.id]??"";return e.jsx(D,{className:"p-1",children:e.jsx(W,{type:"number",min:"0",max:i.max_points,step:"0.1",className:"text-center h-9 w-full min-w-[80px]",value:c,onChange:d=>v(a.id,i.id,d.target.value),placeholder:"-",disabled:o})},i.id)}),e.jsx(D,{className:"text-center font-bold text-lg",children:"-"})]},a.id)),h.length===0&&e.jsx(U,{children:e.jsx(D,{colSpan:2,className:"text-center py-8 text-muted-foreground",children:"Nenhuma avaliação criada para este bimestre."})})]})]})})})]})}),e.jsx(ie,{value:"assessments",className:"flex-1 mt-4",children:e.jsxs(H,{children:[e.jsxs(se,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Avaliações"}),e.jsx(te,{children:"Crie provas e trabalhos para compor a nota."})]}),!o&&e.jsx(Ve,{classRoomId:l.id,gradingPeriodId:t,subjectId:n,onSuccess:u})]}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[h.map(a=>e.jsxs("div",{className:"flex items-center justify-between border p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:[a.title," ",a.is_recovery&&e.jsx(ne,{variant:"destructive",children:"REC"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[new Date(a.date).toLocaleDateString()," • Peso: ",a.weight," • Max: ",a.max_points]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"ghost",size:"icon",disabled:o,children:e.jsx(be,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-red-500",disabled:o,children:e.jsx(Ee,{className:"h-4 w-4"})})]})]},a.id)),h.length===0&&e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"Nenhuma avaliação cadastrada."})]})})]})}),e.jsx(ie,{value:"attendance",className:"flex-1 mt-4",children:e.jsxs(H,{children:[e.jsxs(se,{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Histórico de Frequência"}),e.jsx(te,{children:"Visualize e edite as chamadas realizadas."})]}),e.jsx(g,{asChild:!0,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:e.jsxs(le,{href:`/professor/classes/${l.id}/attendance/create?subject_id=${n}`,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Lançar Nova Chamada"]})})]}),e.jsx(M,{children:e.jsx("div",{className:"space-y-2",children:$.length>0?$.map(a=>e.jsx(le,{href:`/professor/classes/${l.id}/attendance/create?subject_id=${n}&date=${a.date}`,className:"block group",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-card hover:border-blue-500 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-12 w-12 rounded-lg bg-blue-50 text-blue-700 border border-blue-100",children:[e.jsx("span",{className:"text-xs font-bold uppercase",children:new Date(a.date).toLocaleString("default",{month:"short"})}),e.jsx("span",{className:"text-xl font-bold",children:new Date(a.date).getDate()})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground group-hover:text-blue-600 transition-colors",children:["Aula de ",new Date(a.date).toLocaleDateString("pt-BR",{weekday:"long"})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate max-w-[300px] md:max-w-md",children:a.content||"Sem conteúdo registrado"})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"text-muted-foreground group-hover:text-blue-600",children:e.jsx(be,{className:"h-4 w-4"})})]})},a.id)):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:e.jsx("p",{children:"Nenhuma chamada registrada para esta disciplina."})})})})]})})]})]})]})}function Ve(l){const s=ye.c(67),{classRoomId:J,gradingPeriodId:b,subjectId:x,onSuccess:$}=l,[K,Y]=f.useState(!1);let A;s[0]===Symbol.for("react.memo_cache_sentinel")?(A={title:"",date:new Date().toISOString().split("T")[0],max_points:"10",weight:"1",is_recovery:!1,description:""},s[0]=A):A=s[0];const{data:t,setData:r,post:n,processing:L,reset:h,transform:Q}=Se(A);let w;s[1]!==J||s[2]!==b||s[3]!==$||s[4]!==n||s[5]!==h||s[6]!==x||s[7]!==Q?(w=m=>{m.preventDefault(),Q(Ne=>({...Ne,grading_period_id:b,subject_id:x})),n(`/professor/classes/${J}/assessments`,{onSuccess:()=>{Y(!1),h(),$(),X.success("Avaliação criada com sucesso!")}})},s[1]=J,s[2]=b,s[3]=$,s[4]=n,s[5]=h,s[6]=x,s[7]=Q,s[8]=w):w=s[8];const k=w;let y;s[9]===Symbol.for("react.memo_cache_sentinel")?(y=e.jsx(_e,{asChild:!0,children:e.jsxs(g,{variant:"outline",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Nova Avaliação"]})}),s[9]=y):y=s[9];let S;s[10]===Symbol.for("react.memo_cache_sentinel")?(S=e.jsxs(Ce,{children:[e.jsx(De,{children:"Nova Avaliação"}),e.jsx(Te,{children:"Crie uma nova coluna no diário de classe."})]}),s[10]=S):S=s[10];let _;s[11]===Symbol.for("react.memo_cache_sentinel")?(_=e.jsx(T,{htmlFor:"title",children:"Título"}),s[11]=_):_=s[11];let p;s[12]!==r?(p=m=>r("title",m.target.value),s[12]=r,s[13]=p):p=s[13];let C;s[14]!==t.title||s[15]!==p?(C=e.jsxs("div",{className:"grid gap-2",children:[_,e.jsx(W,{id:"title",value:t.title,onChange:p,placeholder:"Ex: Prova 1",required:!0})]}),s[14]=t.title,s[15]=p,s[16]=C):C=s[16];let o;s[17]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx(T,{htmlFor:"date",children:"Data"}),s[17]=o):o=s[17];let u;s[18]!==r?(u=m=>r("date",m.target.value),s[18]=r,s[19]=u):u=s[19];let v;s[20]!==t.date||s[21]!==u?(v=e.jsxs("div",{className:"grid gap-2",children:[o,e.jsx(W,{id:"date",type:"date",value:t.date,onChange:u,required:!0})]}),s[20]=t.date,s[21]=u,s[22]=v):v=s[22];let P;s[23]===Symbol.for("react.memo_cache_sentinel")?(P=e.jsx(T,{htmlFor:"weight",children:"Peso"}),s[23]=P):P=s[23];let N;s[24]!==r?(N=m=>r("weight",m.target.value),s[24]=r,s[25]=N):N=s[25];let a;s[26]!==t.weight||s[27]!==N?(a=e.jsxs("div",{className:"grid gap-2",children:[P,e.jsx(W,{id:"weight",type:"number",step:"0.1",value:t.weight,onChange:N,required:!0})]}),s[26]=t.weight,s[27]=N,s[28]=a):a=s[28];let i;s[29]!==v||s[30]!==a?(i=e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v,a]}),s[29]=v,s[30]=a,s[31]=i):i=s[31];let c;s[32]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx(T,{htmlFor:"max_points",children:"Valor Máx."}),s[32]=c):c=s[32];let d;s[33]!==r?(d=m=>r("max_points",m.target.value),s[33]=r,s[34]=d):d=s[34];let j;s[35]!==t.max_points||s[36]!==d?(j=e.jsxs("div",{className:"grid gap-2",children:[c,e.jsx(W,{id:"max_points",type:"number",step:"0.1",value:t.max_points,onChange:d,required:!0})]}),s[35]=t.max_points,s[36]=d,s[37]=j):j=s[37];let F;s[38]!==r?(F=m=>r("is_recovery",m.target.checked),s[38]=r,s[39]=F):F=s[39];let I;s[40]!==t.is_recovery||s[41]!==F?(I=e.jsx("input",{type:"checkbox",checked:t.is_recovery,onChange:F,className:"rounded border-gray-300 text-primary shadow-sm focus:ring-primary"}),s[40]=t.is_recovery,s[41]=F,s[42]=I):I=s[42];let Z;s[43]===Symbol.for("react.memo_cache_sentinel")?(Z=e.jsx("span",{className:"text-sm font-medium",children:"Recuperação?"}),s[43]=Z):Z=s[43];let q;s[44]!==I?(q=e.jsx("div",{className:"flex items-end pb-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[I,Z]})}),s[44]=I,s[45]=q):q=s[45];let G;s[46]!==j||s[47]!==q?(G=e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[j,q]}),s[46]=j,s[47]=q,s[48]=G):G=s[48];let R;s[49]===Symbol.for("react.memo_cache_sentinel")?(R=e.jsx(T,{htmlFor:"description",children:"Descrição (Opcional)"}),s[49]=R):R=s[49];let z;s[50]!==r?(z=m=>r("description",m.target.value),s[50]=r,s[51]=z):z=s[51];let E;s[52]!==t.description||s[53]!==z?(E=e.jsxs("div",{className:"grid gap-2",children:[R,e.jsx(Fe,{id:"description",value:t.description,onChange:z})]}),s[52]=t.description,s[53]=z,s[54]=E):E=s[54];let V;s[55]!==L?(V=e.jsx($e,{children:e.jsx(g,{type:"submit",disabled:L,children:"Criar Avaliação"})}),s[55]=L,s[56]=V):V=s[56];let B;s[57]!==k||s[58]!==i||s[59]!==G||s[60]!==E||s[61]!==V||s[62]!==C?(B=e.jsxs(Ae,{className:"sm:max-w-[425px]",children:[S,e.jsxs("form",{onSubmit:k,className:"grid gap-4 py-4",children:[C,i,G,E,V]})]}),s[57]=k,s[58]=i,s[59]=G,s[60]=E,s[61]=V,s[62]=C,s[63]=B):B=s[63];let ee;return s[64]!==K||s[65]!==B?(ee=e.jsxs(Le,{open:K,onOpenChange:Y,children:[y,B]}),s[64]=K,s[65]=B,s[66]=ee):ee=s[66],ee}export{Cs as default};
