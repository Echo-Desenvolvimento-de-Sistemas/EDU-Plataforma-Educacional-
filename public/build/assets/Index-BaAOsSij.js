import{c as ie,r as x,j as e,a as O,H as oe}from"./app-BlZNpJaz.js";import{c as le,i as ne,d as ce,e as de,D as me,f as he,g as pe,A as xe}from"./app-layout-vfDevXcM.js";import{B as M}from"./button-BFaAQ1F0.js";import{c as ae,C as te,a as ge,b as ue}from"./card-DE5xUgg4.js";import{S as q,a as U,b as J,c as Q,d as W}from"./select-wa9XAM0x.js";import{I as V}from"./input-ClKI_C3W.js";import{c as fe}from"./utils-CTsRgsKi.js";import{b as Y,e as Z,d as je,T as ve,c as ee,a as be}from"./table-DRoYhqJ6.js";import{B as Ne}from"./badge-hQq2_SSh.js";import{c as re}from"./createLucideIcon-G_Aima0p.js";import{T as ye}from"./trash-2-C65_v2RJ.js";import{t as w}from"./index-Dzrob8QY.js";import{f as we,e as Se,b as Ce,c as De,d as Te,D as Ae}from"./dialog-CCWmf-Wy.js";import{L}from"./label-D4nWcODD.js";import{T as Ee}from"./textarea-BfFOsk1d.js";import{P as ke}from"./plus-CcX2yXqX.js";import{L as X}from"./loader-circle-DIuL06p2.js";import{S as _e}from"./save-zMiZTWPN.js";import{i as se}from"./format-DWNL4VNT.js";/* empty css            */import"./index-BSNktiLJ.js";import"./index-DWBLVih3.js";import"./index-II6TlMg7.js";import"./Combination-CQbiwxas.js";import"./index-ePvy9ijt.js";import"./index-CClcdcON.js";import"./index-DSX7JKB1.js";import"./index-20W_Bwtk.js";import"./index-kh-3lYpY.js";import"./index-jOkOEACf.js";import"./settings-DDioBNBR.js";import"./users-CYmdu12r.js";import"./file-text-BPl73Zr-.js";import"./chevron-right-BaSAJNUd.js";import"./index-DPYlP-Xg.js";import"./chevron-down-BzXkxksi.js";import"./check-C5YBzlMP.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],Ie=re("EllipsisVertical",Fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],Pe=re("Filter",Ge);function $e(E){const s=ie.c(28),{students:d,assessments:u,onGradeChange:b,onDeleteAssessment:S}=E,I=x.useRef({}),k=Le,B=(r,a,t)=>{const m=d[a],n=u[t];if(!m||!n)return;let o,p;if(r.key==="ArrowDown"||r.key==="Enter"?(r.preventDefault(),a<d.length-1&&(o=d[a+1].id,p=n.id)):r.key==="ArrowUp"&&(r.preventDefault(),a>0&&(o=d[a-1].id,p=n.id)),o!==void 0&&p!==void 0){const P=k(o,p);I.current[P]?.focus()}};let C;s[0]!==b?(C=(r,a,t)=>{b(r,a,t)},s[0]=b,s[1]=C):C=s[1];const z=C,D=te,c="border-0 shadow-none sm:border sm:shadow-sm overflow-hidden",f=ae,H="p-0",R="overflow-x-auto pb-5",i=ve;let _;s[2]===Symbol.for("react.memo_cache_sentinel")?(_=e.jsx(ee,{className:"w-[300px] min-w-[200px]",children:"Estudante"}),s[2]=_):_=s[2];let l;if(s[3]!==u||s[4]!==S){let r;s[6]!==S?(r=a=>e.jsx(ee,{className:"text-center min-w-[140px] align-top bg-muted/40 p-2",children:e.jsxs("div",{className:"flex flex-col items-center gap-1 group relative",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 w-full",children:[e.jsx("span",{className:"font-semibold text-foreground whitespace-nowrap truncate max-w-[100px]",title:a.title,children:a.title}),e.jsxs(de,{children:[e.jsx(me,{asChild:!0,children:e.jsx(M,{variant:"ghost",className:"h-6 w-6 p-0 hover:bg-slate-200 rounded-full",children:e.jsx(Ie,{className:"h-3 w-3"})})}),e.jsx(he,{align:"end",children:e.jsxs(pe,{className:"text-red-600 focus:text-red-700 cursor-pointer",onClick:()=>S(a.id),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Excluir Avaliação"]})})]})]}),e.jsxs(Ne,{variant:"outline",className:"text-xs font-normal",children:["Peso: ",a.weight]})]})},a.id),s[6]=S,s[7]=r):r=s[7],l=u.map(r),s[3]=u,s[4]=S,s[5]=l}else l=s[5];let j;s[8]!==l?(j=e.jsx(be,{children:e.jsxs(Y,{className:"bg-muted/40 hover:bg-muted/40",children:[_,l]})}),s[8]=l,s[9]=j):j=s[9];const h=je,G=d.map((r,a)=>e.jsxs(Y,{className:"hover:bg-muted/5",children:[e.jsx(Z,{className:"font-medium p-2 pl-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(le,{className:"h-8 w-8 hidden sm:block",children:[e.jsx(ne,{src:`https://api.dicebear.com/7.x/initials/svg?seed=${r.name}`}),e.jsx(ce,{children:r.name.substring(0,2).toUpperCase()})]}),e.jsx("span",{className:"truncate max-w-[180px] sm:max-w-[250px]",title:r.name,children:r.name})]})}),u.map((t,m)=>{const n=r.grades[t.id]||"",o=parseFloat(n),p=n!==""&&(isNaN(o)||o<0||o>100),P=n!==(r.originalGrades[t.id]||""),$=!p&&n!==""&&o<60;return e.jsx(Z,{className:"p-1.5 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(V,{ref:y=>{y?I.current[k(r.id,t.id)]=y:delete I.current[k(r.id,t.id)]},value:n,onChange:y=>z(r.id,t.id.toString(),y.target.value),onKeyDown:y=>B(y,a,m),className:fe("text-center font-mono h-9 w-20 text-base transition-all",p&&"border-red-500 bg-red-50 text-red-900 focus-visible:ring-red-500",!p&&$&&"text-red-600 font-bold",!p&&P&&"border-blue-400 bg-blue-50/50"),placeholder:"-",type:"number",min:"0",step:"0.1",lang:"en"})})},t.id)})]},r.id));let N;s[10]!==h||s[11]!==G?(N=e.jsx(h,{children:G}),s[10]=h,s[11]=G,s[12]=N):N=s[12];let g;s[13]!==i||s[14]!==j||s[15]!==N?(g=e.jsxs(i,{children:[j,N]}),s[13]=i,s[14]=j,s[15]=N,s[16]=g):g=s[16];let v;s[17]!==d.length?(v=d.length===0&&e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Nenhum aluno encontrado para os filtros selecionados."}),s[17]=d.length,s[18]=v):v=s[18];let T;s[19]!==g||s[20]!==v?(T=e.jsxs("div",{className:R,children:[g,v]}),s[19]=g,s[20]=v,s[21]=T):T=s[21];let A;s[22]!==f||s[23]!==T?(A=e.jsx(f,{className:H,children:T}),s[22]=f,s[23]=T,s[24]=A):A=s[24];let F;return s[25]!==D||s[26]!==A?(F=e.jsx(D,{className:c,children:A}),s[25]=D,s[26]=A,s[27]=F):F=s[27],F}function Le(E,s){return`${E}-${s}`}const Me=[{title:"Painel",href:"/professor/dashboard"},{title:"Lançamento de Notas",href:""}];function ys({classes:E,gradingPeriods:s}){const[d,u]=x.useState([]),[b,S]=x.useState([]),[I,k]=x.useState(!1),[B,C]=x.useState(!1),[z,D]=x.useState(!1),[c,f]=x.useState({title:"",date:se(new Date,"yyyy-MM-dd"),max_points:"10",weight:"1",description:""}),[H,R]=x.useState(!1),[i,_]=x.useState(""),[l,j]=x.useState(""),[h,G]=x.useState(""),N=E.find(a=>a.id.toString()===i),g=N?N.subjects:[];x.useEffect(()=>{g.length===1?j(g[0].id.toString()):g.length>1&&!g.find(a=>a.id.toString()===l)&&j("")},[i]),x.useEffect(()=>{i&&l&&h?v():(u([]),S([]))},[i,l,h]);const v=async()=>{k(!0);try{const a=await O.get(`/professor/classes/${i}/grades?grading_period_id=${h}&subject_id=${l}`),{assessments:t,grades:m,students:n}=a.data;S(t);const o=n.map(p=>{const P=m[p.id]||{},$={};return t&&t.forEach(y=>{const K=P[y.id];$[y.id]=K!=null?String(K):""}),{id:p.id,name:p.name,grades:$,originalGrades:{...$}}});u(o)}catch(a){console.error(a),w.error("Erro ao buscar dados.")}finally{k(!1)}},T=(a,t,m)=>{u(n=>n.map(o=>o.id===a?{...o,grades:{...o.grades,[t]:m}}:o))},A=async()=>{if(!i||!l||!h)return;C(!0);const a=[];if(d.forEach(t=>{b.forEach(m=>{const n=t.grades[m.id],o=t.originalGrades[m.id];n!==o&&a.push({assessment_id:m.id,student_id:t.id,score:n===""?null:n})})}),a.length===0){w.info("Nenhuma alteração para salvar."),C(!1);return}try{await O.post(`/professor/classes/${i}/grades/batch`,{grading_period_id:h,subject_id:l,grades:a}),w.success("Notas salvas com sucesso!"),u(t=>t.map(m=>({...m,originalGrades:{...m.grades}})))}catch(t){console.error(t),w.error("Erro ao salvar notas.")}finally{C(!1)}},F=async a=>{if(confirm("Tem certeza que deseja excluir esta avaliação? Todas as notas associadas serão perdidas."))try{await O.delete(`/professor/classes/${i}/assessments/${a}`),w.success("Avaliação excluída com sucesso."),v()}catch(t){console.error(t),w.error("Erro ao excluir avaliação.")}},r=d.some(a=>Object.keys(a.grades).some(t=>a.grades[t]!==a.originalGrades[t]));return e.jsxs(xe,{breadcrumbs:Me,children:[e.jsx(oe,{title:"Lançamento de Notas"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4 max-w-[95%] mx-auto w-full pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Lançamento de Notas"}),e.jsx("p",{className:"text-muted-foreground",children:"Selecione a turma para visualizar as avaliações."})]}),i&&l&&e.jsxs(M,{onClick:()=>D(!0),variant:"secondary",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Nova Avaliação"]})]}),e.jsxs(te,{children:[e.jsx(ge,{className:"pb-3",children:e.jsxs(ue,{className:"text-base flex items-center",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Filtros de Seleção"]})}),e.jsxs(ae,{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(q,{value:i,onValueChange:_,children:[e.jsx(U,{children:e.jsx(J,{placeholder:"Selecione a Turma"})}),e.jsx(Q,{children:E.map(a=>e.jsx(W,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsxs(q,{value:l,onValueChange:j,disabled:!i,children:[e.jsx(U,{children:e.jsx(J,{placeholder:"Disciplina"})}),e.jsx(Q,{children:g.map(a=>e.jsx(W,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsxs(q,{value:h,onValueChange:G,children:[e.jsx(U,{children:e.jsx(J,{placeholder:"Período / Bimestre"})}),e.jsx(Q,{children:s.map(a=>e.jsx(W,{value:a.id.toString(),children:a.name},a.id))})]})]})]}),I?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(X,{className:"w-8 h-8 animate-spin text-indigo-600"})}):e.jsxs(e.Fragment,{children:[i&&h&&b.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border border-dashed",children:[e.jsx("p",{className:"text-gray-500",children:"Nenhuma avaliação encontrada para este período."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:'Clique em "Nova Avaliação" para começar.'})]}),d.length>0&&b.length>0&&e.jsx("div",{className:"space-y-4",children:e.jsx($e,{students:d,assessments:b,onGradeChange:T,onDeleteAssessment:F})})]}),d.length>0&&b.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-background border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-10 md:static md:shadow-none md:border-t-0 md:bg-transparent",children:e.jsx("div",{className:"max-w-[95%] mx-auto flex justify-end",children:e.jsx(M,{className:"w-full md:w-auto font-bold text-lg h-12 shadow-lg",size:"lg",onClick:A,disabled:B||!r,children:B?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-5 w-5 animate-spin"}),"Salvando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"mr-2 h-5 w-5"}),"Salvar Notas"]})})})})]}),e.jsx(we,{open:z,onOpenChange:D,children:e.jsxs(Se,{children:[e.jsxs(Ce,{children:[e.jsx(De,{children:"Nova Avaliação"}),e.jsx(Te,{children:"Crie uma nova avaliação para lançar notas nesta turma."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"title",children:"Título"}),e.jsx(V,{id:"title",placeholder:"Ex: Prova Mensal, Trabalho em Grupo",value:c.title,onChange:a=>f({...c,title:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"date",children:"Data"}),e.jsx(V,{id:"date",type:"date",value:c.date,onChange:a=>f({...c,date:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"max_points",children:"Valor (Pontos)"}),e.jsx(V,{id:"max_points",type:"number",value:c.max_points,onChange:a=>f({...c,max_points:a.target.value})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"weight",children:"Peso"}),e.jsx(V,{id:"weight",type:"number",step:"0.1",value:c.weight,onChange:a=>f({...c,weight:a.target.value})}),e.jsx("p",{className:"text-[0.8rem] text-muted-foreground",children:"O peso define a importância da nota na média final. Ex: Peso 2 vale o dobro de uma prova com Peso 1."})]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(L,{htmlFor:"description",children:"Descrição"}),e.jsx(Ee,{id:"description",placeholder:"Detalhes da avaliação...",value:c.description,onChange:a=>f({...c,description:a.target.value})})]})]}),e.jsxs(Ae,{children:[e.jsx(M,{variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsx(M,{onClick:async()=>{if(!c.title||!c.date||!c.max_points){w.error("Preencha os campos obrigatórios");return}R(!0);try{const a=await O.post(`/professor/classes/${i}/assessments`,{...c,grading_period_id:h||s[0]?.id,subject_id:l,is_recovery:!1},{headers:{Accept:"application/json"}});w.success(a.data.message||"Avaliação criada!"),D(!1),f({title:"",date:se(new Date,"yyyy-MM-dd"),max_points:"10",weight:"1",description:""}),i&&l&&h&&v()}catch(a){console.error(a),w.error("Erro ao criar avaliação.")}finally{R(!1)}},disabled:H,children:H?e.jsx(X,{className:"w-4 h-4 animate-spin"}):"Criar Avaliação"})]})]})})]})}export{ys as default};
